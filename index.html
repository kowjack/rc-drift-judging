<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TODAK RC Drift Judging System</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;700;900&family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Rajdhani', sans-serif; background: #000; }
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: #1a1a1a; }
        ::-webkit-scrollbar-thumb { background: #E31E24; border-radius: 5px; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;
        const Plus = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>;
        const Trash = () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>;
        const Edit = () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>;
        const Eye = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>;
        const Trophy = () => <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M6 9H4.5a2.5 2.5 0 010-5H6M18 9h1.5a2.5 2.5 0 000-5H18M4 22h16M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22M18 2H6v7a6 6 0 0012 0V2z"/></svg>;

        function App() {
            const [mode, setMode] = useState('setup');
            const [competitors, setCompetitors] = useState([]);
            const [scores, setScores] = useState([]);
            const [currentIdx, setCurrentIdx] = useState(0);
            const [bracket, setBracket] = useState([]);
            const [allRounds, setAllRounds] = useState([]);
            const [currentBattle, setCurrentBattle] = useState(null);

            return (
                <div style={{minHeight: '100vh', background: 'linear-gradient(135deg, #000 0%, #1a1a1a 100%)', color: '#fff'}}>
                    <header style={{background: 'linear-gradient(90deg, #000 0%, #E31E24 100%)', padding: '20px 40px', display: 'flex', gap: '20px', alignItems: 'center', borderBottom: '3px solid #E31E24'}}>
                        <img src="data:image/svg+xml,%3Csvg width='60' height='60' xmlns='http://www.w3.org/2000/svg'%3E%3Crect fill='%23fff' width='60' height='60'/%3E%3Cpath d='M15,30 Q22,20 35,24 Q32,28 35,30 Q38,32 35,38 Q22,42 15,30' fill='%23000'/%3E%3Cpath d='M35,24 L52,14 L35,30' fill='%23000'/%3E%3Ccircle cx='29' cy='26' r='2' fill='%23fff'/%3E%3Ctext x='38' y='34' font-size='16' font-weight='900' fill='%23E31E24' font-family='Orbitron'%3ERC%3C/text%3E%3C/svg%3E" alt="TODAK"/>
                        <div>
                            <h1 style={{fontSize: '32px', fontWeight: 900}}>DRIFT JUDGING SYSTEM</h1>
                            <p style={{fontSize: '14px', opacity: 0.8}}>POWERED BY TODAK RC</p>
                        </div>
                        {mode !== 'setup' && <button onClick={() => {if (confirm('Reset?')) {setMode('setup'); setScores([]); setBracket([]); setAllRounds([]);}}} style={{marginLeft: 'auto', background: 'transparent', border: '2px solid #E31E24', color: '#E31E24', padding: '12px 24px', cursor: 'pointer', fontWeight: 700}}>RESET</button>}
                    </header>
                    {mode === 'setup' && <Setup competitors={competitors} setCompetitors={setCompetitors} setMode={setMode}/>}
                    {mode === 'qualifying' && <Qualifying competitors={competitors} currentIdx={currentIdx} setCurrentIdx={setCurrentIdx} scores={scores} setScores={setScores} setMode={setMode} setBracket={setBracket} setAllRounds={setAllRounds}/>}
                    {mode === 'battle' && <Battle bracket={bracket} setBracket={setBracket} allRounds={allRounds} setAllRounds={setAllRounds} currentBattle={currentBattle} setCurrentBattle={setCurrentBattle}/>}
                </div>
            );
        }

        function Setup({competitors, setCompetitors, setMode}) {
            const [name, setName] = useState('');
            const add = () => {if (name.trim()) {setCompetitors([...competitors, {id: competitors.length + 1, name: name.trim(), num: `#${String(competitors.length + 1).padStart(3, '0')}`}]); setName('');}};
            const quickAdd = (n) => {setCompetitors(Array.from({length: n}, (_, i) => ({id: i + 1, name: `Driver ${i + 1}`, num: `#${String(i + 1).padStart(3, '0')}`})));};
            return (
                <div style={{padding: '40px', maxWidth: '1200px', margin: '0 auto'}}>
                    <h2 style={{fontSize: '48px', textAlign: 'center', marginBottom: '40px', background: 'linear-gradient(90deg, #fff, #E31E24)', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent', fontWeight: 900}}>SETUP COMPETITORS</h2>
                    <div style={{background: 'rgba(255,255,255,0.03)', border: '2px solid rgba(227,30,36,0.3)', padding: '30px', marginBottom: '30px'}}>
                        <h3 style={{marginBottom: '20px', fontSize: '24px'}}>QUICK ADD</h3>
                        <div style={{display: 'flex', gap: '15px', flexWrap: 'wrap'}}>
                            {[8, 16, 24, 32].map(n => <button key={n} onClick={() => quickAdd(n)} style={{background: 'rgba(227,30,36,0.2)', border: '2px solid #E31E24', color: '#fff', padding: '15px 30px', fontSize: '18px', fontWeight: 700, cursor: 'pointer'}}>{n} COMPETITORS</button>)}
                        </div>
                    </div>
                    <div style={{background: 'rgba(255,255,255,0.03)', border: '2px solid rgba(227,30,36,0.3)', padding: '30px', marginBottom: '30px'}}>
                        <h3 style={{marginBottom: '20px', fontSize: '24px'}}>ADD COMPETITOR</h3>
                        <div style={{display: 'flex', gap: '15px'}}>
                            <input value={name} onChange={(e) => setName(e.target.value)} onKeyPress={(e) => e.key === 'Enter' && add()} placeholder="Enter name..." style={{flex: 1, padding: '15px', fontSize: '18px', background: 'rgba(0,0,0,0.5)', border: '2px solid rgba(227,30,36,0.3)', color: '#fff', fontFamily: 'inherit'}}/>
                            <button onClick={add} style={{background: '#E31E24', border: 'none', color: '#000', padding: '15px 30px', fontSize: '18px', fontWeight: 700, cursor: 'pointer', display: 'flex', gap: '8px', alignItems: 'center'}}><Plus/>ADD</button>
                        </div>
                    </div>
                    <div style={{background: 'rgba(255,255,255,0.03)', border: '2px solid rgba(227,30,36,0.3)', padding: '30px', marginBottom: '30px', minHeight: '300px'}}>
                        <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '20px'}}>
                            <h3 style={{fontSize: '24px'}}>COMPETITORS</h3>
                            <div style={{color: '#E31E24', fontSize: '20px', fontWeight: 700}}>{competitors.length} TOTAL</div>
                        </div>
                        {competitors.length === 0 ? <div style={{textAlign: 'center', opacity: 0.5, padding: '60px', fontSize: '18px'}}>No competitors yet</div> : <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(300px, 1fr))', gap: '15px'}}>{competitors.map((c, i) => <div key={i} style={{background: 'rgba(227,30,36,0.1)', border: '1px solid rgba(227,30,36,0.3)', padding: '15px', display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}><div><div style={{fontSize: '18px', fontWeight: 700}}>{c.name}</div><div style={{fontSize: '14px', opacity: 0.7}}>{c.num}</div></div><button onClick={() => {const updated = competitors.filter((_, j) => j !== i); setCompetitors(updated.map((x, k) => ({...x, id: k + 1, num: `#${String(k + 1).padStart(3, '0')}`})));}} style={{background: 'transparent', border: '2px solid #E31E24', color: '#E31E24', padding: '8px', cursor: 'pointer'}}><Trash/></button></div>)}</div>}
                    </div>
                    {competitors.length > 0 && <div style={{textAlign: 'center'}}><button onClick={() => setMode('qualifying')} style={{background: '#E31E24', color: '#000', border: 'none', padding: '20px 60px', fontSize: '24px', fontWeight: 900, cursor: 'pointer'}}>START QUALIFYING ‚Üí</button></div>}
                </div>
            );
        }

        function Qualifying({competitors, currentIdx, setCurrentIdx, scores, setScores, setMode, setBracket, setAllRounds}) {
            const current = competitors[currentIdx];
            const [j1, setJ1] = useState({style: 0});
            const [j2, setJ2] = useState({lineSpeed: 0});
            const [j3, setJ3] = useState({angle: 0});
            const [timer, setTimer] = useState(120);
            const [running, setRunning] = useState(false);
            const [editing, setEditing] = useState(null);

            useEffect(() => {
                let interval;
                if (running && timer > 0) interval = setInterval(() => setTimer(t => t - 1), 1000);
                else if (timer === 0) setRunning(false);
                return () => clearInterval(interval);
            }, [running, timer]);

            const t1 = j1.style;
            const t2 = j2.lineSpeed;
            const t3 = j3.angle;
            const total = t1 + t2 + t3;

            const submit = () => {
                const newScore = {competitor: current, j1Total: t1, j2Total: t2, j3Total: t3, grandTotal: total, judgeScores: {j1, j2, j3}};
                if (editing !== null) {
                    const updated = [...scores];
                    updated[editing] = newScore;
                    setScores(updated);
                    setEditing(null);
                } else {
                    setScores([...scores, newScore]);
                    if (currentIdx < competitors.length - 1) {
                        setCurrentIdx(currentIdx + 1);
                        setJ1({style: 0});
                        setJ2({lineSpeed: 0});
                        setJ3({angle: 0});
                        setTimer(120);
                        setRunning(false);
                    }
                }
            };

            const editScore = (index) => {
                const score = scores[index];
                setJ1(score.judgeScores.j1);
                setJ2(score.judgeScores.j2);
                setJ3(score.judgeScores.j3);
                setEditing(index);
            };

            const finishQualifying = () => {
                if (scores.length < 2) {alert('Need at least 2 competitors!'); return;}
                const sorted = [...scores].sort((a, b) => b.grandTotal - a.grandTotal);
                let size = 2;
                while (size < sorted.length) size *= 2;
                const comps = [...sorted];
                while (comps.length < size) comps.push({competitor: {name: 'BYE'}, grandTotal: 0, isBye: true});
                const r1 = [];
                for (let i = 0; i < comps.length / 2; i++) r1.push({id: i, c1: comps[i], c2: comps[comps.length - 1 - i], winner: null, roundName: getRoundName(size, 1)});
                r1.forEach(b => {if (b.c1.isBye) b.winner = b.c2; else if (b.c2.isBye) b.winner = b.c1;});
                const allR = generateAllRounds([r1], size);
                setBracket(r1);
                setAllRounds(allR);
                setMode('battle');
            };

            const generateAllRounds = (rounds, totalSize) => {
                let currentRound = rounds[rounds.length - 1];
                let remaining = totalSize / Math.pow(2, rounds.length);
                while (remaining > 1) {
                    const nextRound = [];
                    for (let i = 0; i < currentRound.length / 2; i++) nextRound.push({id: i, c1: null, c2: null, winner: null, roundName: getRoundName(totalSize, rounds.length + 1)});
                    rounds.push(nextRound);
                    currentRound = nextRound;
                    remaining /= 2;
                }
                return rounds;
            };

            const getRoundName = (totalSize, roundNum) => {
                const remaining = totalSize / Math.pow(2, roundNum - 1);
                if (remaining === 2) return 'FINAL';
                if (remaining === 4) return 'SEMI-FINALS';
                if (remaining === 8) return 'QUARTER-FINALS';
                return `ROUND OF ${remaining}`;
            };

            const formatTime = (seconds) => `${String(Math.floor(seconds / 60)).padStart(2, '0')}:${String(seconds % 60).padStart(2, '0')}`;

            return (
                <div style={{padding: '40px'}}>
                    <div style={{maxWidth: '1400px', margin: '0 auto'}}>
                        <div style={{background: 'rgba(255,255,255,0.03)', border: '2px solid rgba(227,30,36,0.3)', padding: '20px', marginBottom: '30px', display: 'flex', gap: '20px', alignItems: 'center'}}>
                            <div><div style={{fontSize: '14px', opacity: 0.8}}>PROGRESS</div><div style={{fontSize: '24px', fontWeight: 900}}>{scores.length}/{competitors.length}</div></div>
                            <div style={{flex: 1}}><div style={{height: '30px', background: 'rgba(255,255,255,0.1)', borderRadius: '5px', overflow: 'hidden'}}><div style={{height: '100%', width: `${(scores.length / competitors.length) * 100}%`, background: 'linear-gradient(90deg, #E31E24, #fff)', transition: 'width 0.5s'}}/></div></div>
                            {scores.length >= 2 && <button onClick={finishQualifying} style={{background: '#fff', color: '#000', border: 'none', padding: '15px 30px', fontSize: '18px', fontWeight: 900, cursor: 'pointer'}}>FINISH ‚Üí BATTLE</button>}
                        </div>
                        <div style={{display: 'grid', gridTemplateColumns: '2fr 1fr', gap: '30px'}}>
                            <div style={{background: 'rgba(255,255,255,0.03)', border: '2px solid rgba(227,30,36,0.3)', padding: '30px'}}>
                                <div style={{background: 'linear-gradient(90deg, #E31E24, transparent)', padding: '20px', marginBottom: '30px', display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                                    <div><div style={{fontSize: '14px', opacity: 0.8}}>JUDGING</div><div style={{fontSize: '32px', fontWeight: 900}}>{editing !== null ? scores[editing].competitor.name : current?.name}</div></div>
                                    <div><div style={{fontSize: '48px', fontWeight: 900, color: timer < 30 ? '#E31E24' : '#fff'}}>{formatTime(timer)}</div><div style={{display: 'flex', gap: '10px', marginTop: '10px'}}><button onClick={() => setRunning(!running)} style={{background: running ? '#E31E24' : '#fff', color: '#000', border: 'none', padding: '10px 20px', cursor: 'pointer', fontWeight: 700}}>{running ? 'PAUSE' : 'START'}</button><button onClick={() => setTimer(120)} style={{background: 'transparent', color: '#fff', border: '2px solid #fff', padding: '10px 20px', cursor: 'pointer', fontWeight: 700}}>RESET</button></div></div>
                                </div>
                                <div style={{background: 'rgba(255,255,255,0.05)', border: '1px solid rgba(255,255,255,0.1)', padding: '20px', marginBottom: '20px'}}>
                                    <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '15px'}}><div style={{fontSize: '18px', fontWeight: 700}}>JUDGE 1: STYLE</div><div style={{fontSize: '24px', fontWeight: 900, color: '#E31E24'}}>{t1}/40</div></div>
                                    <div><div style={{fontSize: '12px', opacity: 0.7, marginBottom: '8px'}}>STYLE (40 max)</div><input type="number" min="0" max="40" value={j1.style} onChange={(e) => {const v = Math.min(40, Math.max(0, parseInt(e.target.value) || 0)); setJ1({style: v});}} style={{width: '100%', padding: '12px', fontSize: '20px', fontWeight: 900, textAlign: 'center', background: 'rgba(0,0,0,0.5)', border: '2px solid rgba(227,30,36,0.3)', color: '#fff', fontFamily: 'inherit'}}/></div>
                                </div>
                                <div style={{background: 'rgba(255,255,255,0.05)', border: '1px solid rgba(255,255,255,0.1)', padding: '20px', marginBottom: '20px'}}>
                                    <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '15px'}}><div style={{fontSize: '18px', fontWeight: 700}}>JUDGE 2: LINE + SPEED</div><div style={{fontSize: '24px', fontWeight: 900, color: '#E31E24'}}>{t2}/30</div></div>
                                    <div><div style={{fontSize: '12px', opacity: 0.7, marginBottom: '8px'}}>LINE + SPEED (30 max)</div><input type="number" min="0" max="30" value={j2.lineSpeed} onChange={(e) => {const v = Math.min(30, Math.max(0, parseInt(e.target.value) || 0)); setJ2({lineSpeed: v});}} style={{width: '100%', padding: '12px', fontSize: '20px', fontWeight: 900, textAlign: 'center', background: 'rgba(0,0,0,0.5)', border: '2px solid rgba(227,30,36,0.3)', color: '#fff', fontFamily: 'inherit'}}/></div>
                                </div>
                                <div style={{background: 'rgba(255,255,255,0.05)', border: '1px solid rgba(255,255,255,0.1)', padding: '20px', marginBottom: '20px'}}>
                                    <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '15px'}}><div style={{fontSize: '18px', fontWeight: 700}}>JUDGE 3: ANGLE</div><div style={{fontSize: '24px', fontWeight: 900, color: '#E31E24'}}>{t3}/30</div></div>
                                    <div><div style={{fontSize: '12px', opacity: 0.7, marginBottom: '8px'}}>ANGLE (30 max)</div><input type="number" min="0" max="30" value={j3.angle} onChange={(e) => {const v = Math.min(30, Math.max(0, parseInt(e.target.value) || 0)); setJ3({angle: v});}} style={{width: '100%', padding: '12px', fontSize: '20px', fontWeight: 900, textAlign: 'center', background: 'rgba(0,0,0,0.5)', border: '2px solid rgba(227,30,36,0.3)', color: '#fff', fontFamily: 'inherit'}}/></div>
                                </div>
                                <div style={{padding: '20px', background: 'rgba(227,30,36,0.1)', border: '2px solid #E31E24', display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                                    <div><div style={{fontSize: '14px', opacity: 0.8}}>TOTAL SCORE</div><div style={{fontSize: '48px', fontWeight: 900, color: '#E31E24'}}>{total}/100</div></div>
                                    <button onClick={submit} disabled={total === 0} style={{background: total === 0 ? '#666' : '#E31E24', color: '#000', border: 'none', padding: '20px 40px', fontSize: '18px', fontWeight: 900, cursor: total === 0 ? 'not-allowed' : 'pointer'}}>{editing !== null ? 'SAVE CHANGES' : 'SUBMIT SCORES'}</button>
                                </div>
                            </div>
                            <div style={{background: 'rgba(255,255,255,0.03)', border: '2px solid rgba(255,255,255,0.1)', padding: '30px', maxHeight: '800px', overflow: 'auto'}}>
                                <h3 style={{fontSize: '24px', marginBottom: '20px'}}>LEADERBOARD</h3>
                                {scores.length === 0 ? <div style={{textAlign: 'center', opacity: 0.5, padding: '40px', fontSize: '18px'}}>No scores yet</div> : <div style={{display: 'flex', flexDirection: 'column', gap: '10px'}}>{[...scores].sort((a, b) => b.grandTotal - a.grandTotal).map((s, i) => <div key={i} style={{display: 'grid', gridTemplateColumns: '30px 1fr 50px 80px', gap: '10px', alignItems: 'center', padding: '15px', background: 'rgba(227,30,36,0.1)', border: i < 3 ? '2px solid #E31E24' : '1px solid rgba(255,255,255,0.1)'}}><div style={{fontSize: '20px', fontWeight: 900, color: i === 0 ? '#FFD700' : i === 1 ? '#C0C0C0' : i === 2 ? '#CD7F32' : '#E31E24'}}>{i + 1}</div><div><div style={{fontWeight: 700}}>{s.competitor.name}</div><div style={{fontSize: '12px', opacity: 0.7}}>J1:{s.j1Total} J2:{s.j2Total} J3:{s.j3Total}</div></div><div style={{fontSize: '20px', fontWeight: 900, textAlign: 'right'}}>{s.grandTotal}</div><div style={{display: 'flex', gap: '5px'}}><button onClick={() => editScore(scores.indexOf(s))} style={{background: 'transparent', border: '1px solid #E31E24', color: '#E31E24', padding: '5px', cursor: 'pointer', display: 'flex'}}><Edit/></button><button onClick={() => setScores(scores.filter((_, j) => j !== scores.indexOf(s)))} style={{background: 'transparent', border: '1px solid #E31E24', color: '#E31E24', padding: '5px', cursor: 'pointer', display: 'flex'}}><Trash/></button></div></div>)}</div>}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        function Battle({bracket, setBracket, allRounds, setAllRounds, currentBattle, setCurrentBattle}) {
            const [votes, setVotes] = useState({j1: null, j2: null, j3: null});
            const [showQualifying, setShowQualifying] = useState(false);
            const qualifyingScores = allRounds.length > 0 ? allRounds[0].flatMap(b => [b.c1, b.c2]).filter(c => c && !c.isBye).sort((a, b) => b.grandTotal - a.grandTotal) : [];

            useEffect(() => {
                if (!currentBattle && bracket.length > 0) {
                    const next = bracket.find(b => !b.winner && !b.c1?.isBye && !b.c2?.isBye);
                    if (next) setCurrentBattle(next);
                    else advanceRound();
                }
            }, [bracket, currentBattle]);

            const submit = () => {
                const vals = Object.values(votes);
                const omtVotes = vals.filter(v => v === 'omt').length;
                const c1Votes = vals.filter(v => v === 'c1').length;
                const c2Votes = vals.filter(v => v === 'c2').length;
                if (omtVotes >= 2) {setVotes({j1: null, j2: null, j3: null}); alert(`${omtVotes} judges voted ONE MORE TIME! Battle again!`); return;}
                const winner = c1Votes > c2Votes ? currentBattle.c1 : currentBattle.c2;
                const updated = bracket.map(b => b.id === currentBattle.id ? {...b, winner, votes: {c1Votes, c2Votes}} : b);
                setBracket(updated);
                setVotes({j1: null, j2: null, j3: null});
                const next = updated.find(b => !b.winner && !b.c1?.isBye && !b.c2?.isBye);
                if (!next) advanceRound(updated);
                else setCurrentBattle(next);
            };

            const advanceRound = (currentBracket = bracket) => {
                const winners = currentBracket.map(b => b.winner).filter(w => w);
                if (winners.length === 1) {setCurrentBattle(null); return;}
                const nextRound = [];
                for (let i = 0; i < winners.length / 2; i++) nextRound.push({id: i, c1: winners[i * 2], c2: winners[i * 2 + 1], winner: null, roundName: getRoundName(winners.length)});
                const updatedAllRounds = [...allRounds];
                const currentRoundIndex = allRounds.findIndex(r => r === currentBracket);
                if (currentRoundIndex >= 0 && currentRoundIndex + 1 < allRounds.length) updatedAllRounds[currentRoundIndex + 1] = nextRound;
                setAllRounds(updatedAllRounds);
                setBracket(nextRound);
                setCurrentBattle(nextRound[0]);
            };

            const getRoundName = (remaining) => {
                if (remaining === 2) return 'FINAL';
                if (remaining === 4) return 'SEMI-FINALS';
                if (remaining === 8) return 'QUARTER-FINALS';
                return `ROUND OF ${remaining}`;
            };

            return (
                <div style={{padding: '40px'}}>
                    <div style={{maxWidth: '1800px', margin: '0 auto'}}>
                        {currentBattle ? (
                            <>
                                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '30px'}}>
                                    <h2 style={{fontSize: '48px', fontWeight: 900, color: '#E31E24'}}>{currentBattle.roundName}</h2>
                                    <button onClick={() => setShowQualifying(!showQualifying)} style={{background: showQualifying ? '#E31E24' : 'transparent', color: showQualifying ? '#000' : '#E31E24', border: '2px solid #E31E24', padding: '15px 30px', fontWeight: 700, cursor: 'pointer', display: 'flex', gap: '8px', alignItems: 'center'}}><Eye/>{showQualifying ? 'HIDE' : 'VIEW'} QUALIFYING RESULTS</button>
                                </div>
                                {showQualifying && <div style={{background: 'rgba(0,0,0,0.5)', border: '2px solid #E31E24', padding: '30px', marginBottom: '30px'}}><h3 style={{textAlign: 'center', marginBottom: '20px', fontSize: '24px'}}>QUALIFYING RESULTS</h3><div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', gap: '15px', maxHeight: '400px', overflow: 'auto'}}>{qualifyingScores.map((s, i) => <div key={i} style={{background: 'rgba(227,30,36,0.1)', border: i < 3 ? '2px solid #E31E24' : '1px solid rgba(255,255,255,0.3)', padding: '15px'}}><div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '5px'}}><span style={{fontSize: '24px', fontWeight: 900, color: i === 0 ? '#FFD700' : i === 1 ? '#C0C0C0' : i === 2 ? '#CD7F32' : '#E31E24'}}>#{i + 1}</span><span style={{fontSize: '24px', fontWeight: 900}}>{s.grandTotal}</span></div><div style={{fontSize: '18px', fontWeight: 700}}>{s.competitor.name}</div><div style={{fontSize: '12px', opacity: 0.7}}>J1:{s.j1Total} J2:{s.j2Total} J3:{s.j3Total}</div></div>)}</div></div>}
                                <div style={{background: 'rgba(0,0,0,0.5)', border: '2px solid #E31E24', padding: '30px', marginBottom: '30px', overflowX: 'auto'}}><h3 style={{textAlign: 'center', marginBottom: '20px', fontSize: '24px'}}>TOURNAMENT BRACKET</h3><BracketChart allRounds={allRounds} currentBattle={currentBattle}/></div>
                                <div style={{background: 'rgba(255,255,255,0.03)', border: '2px solid rgba(227,30,36,0.3)', padding: '40px'}}>
                                    <div style={{display: 'grid', gridTemplateColumns: '1fr auto 1fr', gap: '30px', alignItems: 'center', marginBottom: '40px'}}>
                                        <div style={{background: 'rgba(227,30,36,0.1)', border: '2px solid #E31E24', padding: '30px', textAlign: 'left'}}><div style={{fontSize: '28px', fontWeight: 900}}>{currentBattle.c1.competitor.name}</div><div style={{fontSize: '14px', opacity: 0.7}}>SCORE: {currentBattle.c1.grandTotal}</div></div>
                                        <div style={{fontSize: '48px', fontWeight: 900, color: '#E31E24'}}>VS</div>
                                        <div style={{background: 'rgba(227,30,36,0.1)', border: '2px solid #E31E24', padding: '30px', textAlign: 'right'}}><div style={{fontSize: '28px', fontWeight: 900}}>{currentBattle.c2.competitor.name}</div><div style={{fontSize: '14px', opacity: 0.7}}>SCORE: {currentBattle.c2.grandTotal}</div></div>
                                    </div>
                                    <div style={{background: 'rgba(0,0,0,0.5)', padding: '30px', border: '2px solid rgba(227,30,36,0.3)'}}>
                                        <h3 style={{fontSize: '20px', fontWeight: 700, marginBottom: '20px'}}>JUDGE VOTES</h3>
                                        {['j1', 'j2', 'j3'].map((j, idx) => <div key={j} style={{display: 'grid', gridTemplateColumns: '100px 1fr 1fr 1fr', gap: '15px', marginBottom: '15px'}}><div style={{fontWeight: 700, display: 'flex', alignItems: 'center'}}>JUDGE {idx + 1}</div><button onClick={() => setVotes({...votes, [j]: 'c1'})} style={{padding: '15px', background: votes[j] === 'c1' ? '#E31E24' : 'rgba(255,255,255,0.1)', color: votes[j] === 'c1' ? '#000' : '#fff', border: votes[j] === 'c1' ? '2px solid #fff' : '2px solid rgba(255,255,255,0.2)', cursor: 'pointer', fontWeight: 700, fontSize: '14px'}}>{currentBattle.c1.competitor.name}</button><button onClick={() => setVotes({...votes, [j]: 'omt'})} style={{padding: '15px', background: votes[j] === 'omt' ? '#FFD700' : 'rgba(255,215,0,0.2)', color: '#000', border: votes[j] === 'omt' ? '2px solid #fff' : '2px solid rgba(255,215,0,0.5)', cursor: 'pointer', fontWeight: 900, fontSize: '13px'}}>ONE MORE TIME</button><button onClick={() => setVotes({...votes, [j]: 'c2'})} style={{padding: '15px', background: votes[j] === 'c2' ? '#E31E24' : 'rgba(255,255,255,0.1)', color: votes[j] === 'c2' ? '#000' : '#fff', border: votes[j] === 'c2' ? '2px solid #fff' : '2px solid rgba(255,255,255,0.2)', cursor: 'pointer', fontWeight: 700, fontSize: '14px'}}>{currentBattle.c2.competitor.name}</button></div>)}
                                        <button onClick={submit} disabled={Object.values(votes).some(v => v === null)} style={{marginTop: '30px', width: '100%', padding: '20px', background: Object.values(votes).some(v => v === null) ? '#666' : '#E31E24', color: '#000', border: 'none', fontSize: '18px', fontWeight: 900, cursor: Object.values(votes).some(v => v === null) ? 'not-allowed' : 'pointer', letterSpacing: '2px'}}>SUBMIT VOTES</button>
                                    </div>
                                </div>
                            </>
                        ) : (
                            <div style={{textAlign: 'center', padding: '100px'}}><Trophy/><h2 style={{fontSize: '48px', fontWeight: 900, marginTop: '30px'}}>TOURNAMENT COMPLETE!</h2>{bracket[0]?.winner && <div style={{marginTop: '40px'}}><div style={{fontSize: '32px', color: '#FFD700', marginBottom: '10px'}}>üèÜ CHAMPION üèÜ</div><div style={{fontSize: '48px', fontWeight: 900}}>{bracket[0].winner.competitor.name}</div></div>}</div>
                        )}
                    </div>
                </div>
            );
        }

        function BracketChart({allRounds, currentBattle}) {
            if (!allRounds || allRounds.length === 0) return null;
            return (
                <div style={{display: 'flex', gap: '100px', justifyContent: 'center', padding: '40px', overflowX: 'auto', position: 'relative'}}>
                    <svg style={{position: 'absolute', top: 0, left: 0, width: '100%', height: '100%', pointerEvents: 'none', zIndex: 1}}>
                        {allRounds.map((round, ri) => {
                            if (ri === allRounds.length - 1) return null;
                            return round.map((match, mi) => {
                                const y1 = 100 + mi * 150;
                                const x1 = (ri + 1) * 300;
                                const x2 = x1 + 100;
                                const nextMatchIndex = Math.floor(mi / 2);
                                const y2 = 100 + nextMatchIndex * 300 + (mi % 2 === 0 ? -50 : 50);
                                return <g key={`${ri}-${mi}`}><line x1={x1} y1={y1} x2={x1 + 50} y2={y1} stroke="#E31E24" strokeWidth="2"/><line x1={x1 + 50} y1={y1} x2={x1 + 50} y2={y2} stroke="#E31E24" strokeWidth="2"/><line x1={x1 + 50} y1={y2} x2={x2} y2={y2} stroke="#E31E24" strokeWidth="2"/></g>;
                            });
                        })}
                    </svg>
                    {allRounds.map((round, ri) => <div key={ri} style={{display: 'flex', flexDirection: 'column', justifyContent: 'space-around', minHeight: '600px', position: 'relative', zIndex: 2}}><div style={{fontSize: '18px', fontWeight: 900, marginBottom: '20px', textAlign: 'center', color: '#E31E24'}}>{round[0]?.roundName || `ROUND ${ri + 1}`}</div>{round.map((match, mi) => <div key={mi} style={{background: 'rgba(255,255,255,0.05)', border: match.id === currentBattle?.id ? '3px solid #FFD700' : '2px solid rgba(227,30,36,0.3)', padding: '15px', margin: '20px 0', minWidth: '200px'}}><div style={{padding: '10px', margin: '5px 0', background: 'rgba(0,0,0,0.3)', borderLeft: match.winner === match.c1 ? '3px solid #FFD700' : '3px solid transparent'}}><div style={{fontWeight: 700, fontSize: '14px'}}>{match.c1?.competitor?.name || 'TBD'}</div>{match.c1?.grandTotal !== undefined && <div style={{fontSize: '12px', opacity: 0.7}}>{match.c1.grandTotal}</div>}</div><div style={{textAlign: 'center', fontSize: '10px', opacity: 0.5, margin: '5px 0'}}>VS</div><div style={{padding: '10px', margin: '5px 0', background: 'rgba(0,0,0,0.3)', borderLeft: match.winner === match.c2 ? '3px solid #FFD700' : '3px solid transparent'}}><div style={{fontWeight: 700, fontSize: '14px'}}>{match.c2?.competitor?.name || 'TBD'}</div>{match.c2?.grandTotal !== undefined && <div style={{fontSize: '12px', opacity: 0.7}}>{match.c2.grandTotal}</div>}</div></div>)}</div>)}
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
